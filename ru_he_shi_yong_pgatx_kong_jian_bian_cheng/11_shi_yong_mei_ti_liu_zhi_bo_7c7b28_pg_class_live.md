## 11\. 使用媒体流直播类(PG_CLASS_Live) {#11-pg-class-live}

### 1) 媒体流的播放和收看 {#1}

媒体流直播类支持三种媒体流类型：实时捕捉的音频流、实时捕捉的视频流和播放AVI文件影音流。在直播通信组中只能由一个节点作为源节点播放媒体流，其他节点都是收看节点。如果通信组内存在2个以上的源节点，则会导致直播状态混乱。调用PG_METH_LIVE_Open方法打开媒体流直播对象后，还需要调用PG_METH_LIVE_Ctrl方法执行PG_LIVE_CTRL_Play动作，才能开始播放或收看媒体流。在收看节点上，媒体流要经过一段时间的缓冲后才输出。

### 2) 媒体源的切换 {#2}

媒体流直播过程中有时需要切换到新的媒体源，恰当的操作能使切换过程平滑，产生的停顿较短。切换媒体源有2种情况：

(1) 在同一个节点上切换不同的媒体流，例如播放另外一个AVI文件。这种情况时，应先调用PG_METH_LIVE_Close方法关闭原来的媒体流，再调用PG_METH_LIVE_Open方法打开新的媒体流，然后执行PG_LIVE_CTRL_Play动作开始播放。

(2) 在不同的节点上切换不同的媒体流，例如切换到另外一个节点的实时捕捉视频流。这样情况时，可先在新的源节点上调用PG_METH_LIVE_Open打开媒体流，但不要执行PG_LIVE_CTRL_Play动作。待老的源节点上调用PG_METH_LIVE_Close方法关闭原来的媒体流后，新的源节点上立即执行PG_LIVE_CTRL_Play动作开始播放。

不管是哪种情况，切换前和切换后的媒体流类型和媒体流格式必须一致，否则收看节点将不接受新的媒体流。

### 3) 媒体流录制 {#3}

在收看节点上调用PG_METH_LIVE_Record方法可以把媒体流录制到 Path参数指定的AVI文件中。如果调用时指定Path参数为空，则停止当前正在进行的录制操作。请参考“[音频录制](..\jie_dian_gong_neng_lei_de_bian_cheng_can_80033a\11_pgclasslive_7c7b3a.md#5)”和“

视频录制

”章节。